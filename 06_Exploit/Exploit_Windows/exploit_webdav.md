# Exploit WebDAV

## Contents
- [Methodology](#)
  - [WebDAV](#)
  - [WebDAV Exploitation Process](#)
- [Tools](#)
  - [davtest](#davtest)
  - [cadaver](#cadaver)
- [Exploit Steps](#)
  - [1. Scan](#)
  - [2. Browser Confirmation](#)
  - [3. Brute Force with Hydra](#)
  - [4. davtest](#)
  - [5. cadaver](#)

## Methodology 

### WebDAV
> Web-based Distributed Authoring and Versioning
- This is a set of extensions to the HTTP protocol that allows users to collaboratively edit and manage files on remote web servers.
- It essentially enables a web server to function like a file server for collaborative editing.
- WebDAV runs on top of Microsoft IIS (on the same ports 80/443).
- In order to connect to a WebDAV server, you need to provide legitimate credentials.
  - This is because WebDAV implements authentication in the form of username/password creds.
  - This authentication is usually done through a browser and specifying the WebDAV folder.

### WebDAV Exploitation Process
1. Identify whether **WebDAV** has been configured to run on the IIS web server.  
  a. This should be detected during your enumeration phase.  
  b. Could be an IIS or Apache server, but you need to ID the WebDAV.  
3. Perform a **brute-force** attack on the WebDAV server in order to identify legitimate creds that we can use for authentication.  
  a. If there is no authentication configured on the WebDAV server...  
  b. ...access is easy.  
4. With legitimate creds, we can **authenticate** on the WebDAV server and upload a malicious .asp payload that can be used to execute arbitrary commands, or we can use it to obtain a reverse shell on the target.

## Tools

### davtest
> DAVTest tests WebDAV enabled servers by uploading test executable files, and then (optionally) uploading files which allow for command execution or other actions directly on the target. It is meant for penetration testers to quickly and easily determine if enabled DAV services are exploitable.
- Used to scan, authenticate against, and exploit a WebDAV server
- Pre-installed on most offensive pentesting distros like Kali and ParrotOS.
- This program attempts to exploit WebDAV enabled servers by:
  - attempting to create a new directory (MKCOL)
  - attempting to put test files of various programming langauges (PUT)
  - optionally attempt to put files with .txt extension, then move to executable (MOVE)
  - optionally attempt to put files with .txt extension, then copy to executable (COPY)
  - check if files executed or were uploaded properly
  - optionally upload a backdoor/shell file for languages which execute
- Additionally, davtest can be used to put an arbitrary file to remote systems.

### cadaver
> cadaver supports file upload, file download, on-screen display, in-place editing, namespace operationgs (move/copy), collection creation and deletion, property manipulation, and resource locking on WebDAV servers.
- Its operation is similar to the standard BSD ftp client and the Samba Project’s smbclient.
- Pre-installed on most offensive pentesting distros like Kali and ParrotOS.

## Exploit Steps

- Resource for the same process: [Exploit WebDAV for Shell](https://null-byte.wonderhowto.com/how-to/exploit-webdav-server-get-shell-0204718/)

### 1. Scan
```
# initial scan:
nmap -sS -sV -sC -0 -T4 -p- [target ip]
# enumerate some http stuff:
nmap -sV -p 80 --script http-enum
```
- Should tell us if WebDAV is configured, where the WebDAV directory is, etc.
- The `/webdav/` does exist and is flagged as "potentionally interesting."
- Also note: "401 Unauthorized" (i.e., authentication has been enabled; you need creds)

### 2. Browser Confirmation
- Confirm this info via a browser: Open the browser and browse to the webdav folder on the target.
- Authentication is probably required. You need a username and password. So...

### 3. Brute Force with [Hydra](../../hydra.md)
```
hydra -L /.../common-users.txt -P  /.../common-passwords.txt [target ip] http-get /webdav/
```
- `-L` : Indicates the "Login" (capital: file of multiple; lower case for single)
- `-P` : Indicates the "Passwords" (capital: file of multiple; lower case for single)
- `http-get` : Indicates the protocol to be used
- `/webdav/` : Indicates the directory where hydra can find the authentication mechanism

#### Back to your Browsewr
- Enter the provided login creds (username/password) Hydra gave you.
- You should have access to the WebDAV directory

#### Remember what WebDAV is and does:
  - You have access to the WebDAV folder. You can upload and download files.
  - Use your tools (following & [resource](https://null-byte.wonderhowto.com/how-to/exploit-webdav-server-get-shell-0204718/))

### 4. [davtest](https://www.kali.org/tools/davtest/)
```
davtest -url http://[target_ip]/webdav/
# will fail if authentication is enable
davtest -auth [username]:[password] -url http://[target_ip]/webdav/
```
- This will execute a series of checks and then return the results to the screen
- This program attempts to exploit WebDAV enabled servers by:
  - attempting to create a new directory (MKCOL)
  - attempting to put test files of various programming langauges (PUT)
  - optionally attempt to put files with .txt extension, then move to executable (MOVE)
  - optionally attempt to put files with .txt extension, then copy to executable (COPY)
  - check if files executed or were uploaded properly
  - optionally upload a backdoor/shell file for languages which execute
- Additionally, this can be used to put an arbitrary file to remote systems.
- But... we'll use cadaver to upload our goodies... 

### 5. [cadaver](https://www.kali.org/tools/cadaver/)
> Cadaver offers an intuitive interface for interacting with the WebDAV service — with FTP-like commands that are simple to use.
```
# syntax to start:
cadaver http://[target_ip]/webdav/
```
- You'll be prompted for creds. Then you will give you a pseudo-shell to interact with the WebDAV server
- **_`Exploit`: Upload a webshell to actuall obtain access._**
- Open a new term window. Kali comes prepackaged with sever webshells: `/usr/share/webshells`
  - List out the contents of that directory and you'll see several subdirs for the various types of webshells available
  - davtest said .asp files can be executed, so cd into that directory (adapt accordingly)
  - Utilize: webshell.asp (make note of where that file is)
- Back to cadaver...
  - At the prompt: `put /usr/share/webshells/asp/webshell.asp`
  - That uploads the webshell
- Back to your browser
  - Refresh and you should see the webshell.asp file in the WebDAV directory
  - Double click that thang!
  - Run some commands: `whoami`, `ipconfig`, `dir`, fiddle around and find the flag (or whatever)
  - If you cannot `cd ..`  to move around, use `dir` to look at subdirs (e.g., `dir c:\` )




