# Antivirus (AV) Evasion

## Contents
- [](#)

## [Defense Evasion](https://attack.mitre.org/tactics/TA0005/)
- Defense evasion consists of techniques that adversaries use to avoid detection throughout their compromise.
- Techniques used for defense evasion include uninstalling/disabling security software or obfuscating/encrypting data and scripts.
- Adversaries also leverage and abuse trusted processes to hide and masquerade their malware.
- Source: MITRE

## AV Detection Methods

### Signature-Based Detection
- An AV signature is a unique sequence of bytes that uniquely identifies malware.
  - As a result, you will have to ensure that your obfuscated exploit or payload does not match any known signature in the AV database.
- We can bypass signature-based detection by modifying the malware's byte sequence, and thereby changing its signature.

### Heuristic-Based Detection
- Heuristic: [def] proceeding to a solution by trial and error or by rules that are only loosely defined.
- This detection method relies on rules or decisions to determine whether a binary is malicious.
- It also looks for specific patterns within the code or program calls.

### Behavior-Based Detection
- Relies on identifying malware by monitoring its behavior (used for newer strains of malware).

## AV Evasion Techniques

### On-Disk Evasion Techniques

#### Obfuscation
- Obfuscation refers to the process of concealing something important, valuable or critical.
- Obfuscation reorganizes code in order to make it harder to analyze or reverse-engineer.

#### Encoding
- Encoding data is a process involving changing data into a new format using a scheme.
- Encoding is a reversible process. Data can be encoded to a new format and decoded to its original format.

#### Packing
- Generate an executable with a new binary structure with a smaller size and thereby provide a payload with a different/unique signature.

#### Crypters
- Encrypts code or payloads and decrypts the encrypted code in memory.
- The decryption key/function is usually stored in a stub. 

### In-Memory Evasion Techniques
- Focuses on manipuation of memory and does not write files to disk.
- Injects payload into a process by leveraging various Windows APIs.
- Payload is then executed in memory in a separate thread. 

## Tools

### [Shellter](https://www.shellterproject.com/)
> Shellter is a dynamic shellcode injection tool, and the first truly dynamic PE infector ever created. It can be used in order to inject shellcode into native Windows applications. The shellcode can be something yours or something generated through a framework, such as Metasploit.> 

#### Installation 
- There's a hitch: Shellter is a Windows executable file. This means you need to use Wine.
- Wine is a compatibility layer for Linux so Linux users can execute Windows binaries. 
```
apt install shellter -y
```
- There's a hitch: Shellter is a Windows executable file. This means you need to use Wine.
- Wine is a compatibility layer for Linux so Linux users can execute Windows binaries. 

###
