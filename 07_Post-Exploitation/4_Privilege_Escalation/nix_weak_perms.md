# Linux Privilege Escalation: Weak Permissions

## Contents
- []()
- []()
- []()
- []()
- []()
- []()

## Intro
- Remember: [The LinEnum Bash script](../1_Local_Enumeration/nix_automating_local_enum.md#a-linux-local-enum-script) automates common Linux local enumeration checks in addition to identifying privilege escalation vulnerabilities.
- There are multiple ways to elevate privileges in Linux. This page does not cover them all.
  - This following just covers the IDEA of how important privileges are on Linux
  - Misconfigurations can be exploited

## Standard Local Enumeration
- Start with some general commands to get an idea of what you're dealing with.
```
whoami
cat /etc/passwd    # what other users exist on the system; only other logon: root
groups             # list out the groups
cat /etc/group     # most are for services
groups student     # see what groups your account forms part of
```

## Find Files with Weak Perms
```
find / -type f -perm -666 2>/dev/null
```
- `/` : from the root of the file system, down into every subdir
- `-type` : what are we looking for? what type of thing?
- `f` : files (not directories, pipes, etc.)
- `-perm` : search for files with the following perms
- `-666` = rw-rw-rw-
  - The `-` (i.e., `-666`) says "at least" (and more, doesn't matter; anything 666 and up)
- `2>/dev/null` : send STDERR to /dev/null

## Scenario: /etc/shadow
> This is from a lab. The above search found /etc/shadow was misconfigured with weak perms and could be written to by any user.
```
$ cat /etc/shadow
root:*.17764:0:99999"7:::
# and others...
```

### Create a New Password Hash

#### How to manually hash a password in Linux:
  - [How to hash passwords on Linux](https://linuxconfig.org/how-to-hash-passwords-on-linux)
  - [Manually generate password for /etc/shadow](https://unix.stackexchange.com/questions/81240/manually-generate-password-for-etc-shadow)
- There are several methods:  mkpasswd, python, and openssl
 
#### OpenSSL to Has a Password
- General Syntax (from the [general man page](https://linux.die.net/man/1/openssl))
```
openssl command [ command_opts ] [ command_args ] 
```
- Syntax, passwd command (from the [passwd man page](https://www.openssl.org/docs/man1.1.1/man1/openssl-passwd.html))
```
openssl passwd -# -salt [xyz] [yourpass]
openssl passwd -1 -salt 123 p@ssw0rd!      # results in a hash value 
```
- The number (`-#`) can be 1, 5, or 6 (see the linked man page)
  - `-1` : MD5 (weakest)
  - `-5` : SHA256 (pretty good)
  - `-6` : SHA512 (best)
- The `-salt` option requires a string as an argument (your choice)
- The final argument is your password of choice

### The Hack: Password Replacement
- Copy and paste the hash value from opensll into the hash field of root in /etc/shadow
  - That is the second field, after the username (root) and the first delimiting colon (`:`)
  - There is an asterisk in this field. Replace it with the hash.
  - Use vim or some other text edit. Put the hash in the /etc/shadow password hash field for root. Save. Quit.
```
su -
```
- Enter your p@ssw0rd! and you are root.

