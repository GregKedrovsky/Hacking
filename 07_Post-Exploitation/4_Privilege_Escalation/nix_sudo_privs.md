# Linux Privilege Escalation: SUDO Privileges

## Contents
- [What are we looking for?]()
- [Standard Local Enumeration]()
  - [Results]()
  - [The Vulnerability]()
- [The Hack: `sudo man [command]`]()

## What are we looking for?
- We are looking for poorly configured binaries (executables) on the compromised Linux system.
  - We can use these binaries to elevate our privileges
- Many binaries in Linux can be used to execute specific commands.
  - If a binary has sudo privileges attached (without a password), you may be able to use that binary to spawn a shell (thus gaining root privs). 

## Standard Local Enumeration

### `sudo -l`
```
cat /etc/passwd     #find out what other users are configured on the system
sudo -l
```
-  `-l` (lowercase "L" for list) list out the sudo commands the current user can run.
-  [From the man page](https://linux.die.net/man/8/sudo): The `-l` (list) option will list the allowed (and forbidden) commands for the invoking user (or the user specified by the -U option) on the current host.

### Results
- Assume we found a binary we can run with sudo privileges: `/sur/bin/man`
- And the "NOPASSWD" option has been set
- So we can run that command as root without any password or authentication
- This is a misconfiguration because...

### The Vulnerability
- The `man` utility (to display "man pages") allows you to spawn a Bash shell via the utility itself.
- The normal way you'd open a man page is `man [command]`.
  - This will open the man page with the current user's privileges.
- But if you can run `/usr/bin/man` with root privs using `sudo` (because it's set with "NOPASSWD"), then you can open a shell as root.
  - Preface the `man` comand with `sudo`. That runs the command with root privileges: `sudo man [command]`
  - And since the system is configured to run `/usr/bin/man` via sudo without a password, you are not prompted for any authentication. 

## The Hack: `sudo man [command]`
- Open a man page (any man page) with sudo: `sudo man [command]` 
- It parses out the contents of the man page with "more"
- While the man page is displayed, you can enter commands with the "!"
  - Example:  `!/bin/bash`
  - This is a function of more not of man.
  - [From the more man page](https://man7.org/linux/man-pages/man1/more.1.html): `!command` or `:!command` : Execute command in a subshell.
  - `less` works the same way.
- This results in a Bash session as root (the owner of the man process from which the shell was spawned).

