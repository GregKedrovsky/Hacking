# Linux Privilege Escalation: Exploiting SUID Binaries

## Contents
- [Intro](#intro)
  - [What are SUID Binaries?](#what-are-suid-binaries)
  - [Anatomy of Linux Permissions](#anatomy-of-linux-permissions)
  - [Exploiting SUID Binaries](#exploiting-suid-binaries)
- [Find SUID Files](#find-suid-files)
- [Techniques & Tools](#techniques--tools)
  - [Scenario](#scenario)
  - [Initial Info Gathering](#initial-info-gathering)
  - [The Hack](#the-hack)

## Intro

### What are SUID Binaries?
- In addition to the three main file access permissions (read, write, execute), Linux also provides users with specialized permissions that can be utilized in specific situations. One of these access permissions is the SUID (Set User ID) permission.
- When applied, this permission provides users with the ability to execute a script or binary with the permissions of the file owner as opposed to the user that is running the script or binary.
- SUID perms are typically used to provide unprivileged users with the ability to run specific scripts or binaries with "root" perms.
  - It should be noted, however, that the provision of elevated privileges is limited to the execution of the script and does not translate to elevation of privileges.
  - However, If improperly configured, unprivileged users can exploit misconfigurations or vulnerabilities within the binary or script to obtain an elevated session. 

### Anatomy of Linux Permissions
&nbsp;&nbsp;&nbsp;![image](https://github.com/GregKedrovsky/Hacking/assets/26492233/6dca53ac-3e7d-48a0-afef-ae8feb557ae6) ![suid](https://github.com/GregKedrovsky/Hacking/assets/26492233/b255227b-0ac8-405e-8d48-08c906f3edca)

- `SUID` - If SUID bit is set on a file and a user executed it, the process will have the same rights as the owner of the file being executed.
- `GUID` - Same as SUID but with group ownership: the process will have the same group rights of the file being executed.
- `Sticky Bit` - If the directory has the sticky bit set, a file can be deleted only by the file owner, the directory owner, or by a privileged user. The sticky bit prevents a user from deleting other users' files from public directories such as /tmp:

### Exploiting SUID Binaries
- This is the functionality that we will be attempting to exploit in order to elevate our privileges.
- However, the success of the attack will depend on the following factors:
  - Owner of the SUID Binary: Given that we are attempting to elevate our privileges, we will only be exploiting SUID binaries that are owned by the "root" user or other privileged users.
  - Access Permissions: We will require executable permissions in order to execute the SUID binary.

----
## Find SUID Files

```
find / -perm /4000  # find SUID files
find / -perm /2000  # find SGID files
find / -perm /6000  # find both SUID and SGID files: 
```

----
## Techniques & Tools
> Although the following is VERY simplistic, it illustrates the concept and process.

### Scenario
- You have access to the target machine as "user1" (an unprivileged user).
  - Simple Enum: `whoami`, `groups user1`
- Within user1's home dir there are three files, one of which is `welcome`
  - This file is owned by root and is executable by user, group, and world; it also has the suid bit set.
  - So we have a file that when executed is executed with root privileges.
 
### Initial Info Gathering
- Use the file command to find out some information about the binary `welcome`
```
pwd
# /home/user1
file welcome
```
- There's nothing of note in that. Sometimes you can use unloaded binaries (like the so.2 file) and provide a malicious file for the program to load instead. But, here... not much. Moving on.
- Use the strings command to print any readable characters in the file.
```
strings welcome
```
- At the top you can see the binary loads a shared object (an .so file)
- A few lines down, you can see that "greetings" is listed. That is apparently the greeetings file in the same subdir.  Since it's an suid binary, `welcome` will execute `greetings` with root perms.

### The Hack
```
rm greetings
cp /bin/bash greetings   # copies bash shell to the current directory and names it greetings
```
- Now, when `welcome` is run and it calls `greetings`, you get a bash shell with root privileges.

