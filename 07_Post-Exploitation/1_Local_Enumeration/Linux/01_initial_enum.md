# Linux - Initial Enumeration
> Assumption: You have hacked into the target box but only have low-level (user/service) access.

## Contents
- [Intro & Overview](#intro--overview)
  - [The 5 Stages of a Hack](#remember-the-5-stages-of-a-hack-here)
  - [Quick Wins](#quick-wins)
- [System Enumeration](#system-enumeration)
- [User Enumeration](#user-enumeration)
- [Network Enumeration](#network-enumeration)
- [Password Hunting](#password-hunting)

## Intro & Overview

### Remember the 5 Stages of a Hack ([here](../../00_Methodology_and_Resources#five-stages-of-ethical-hacking)):
1. Information Gathering
2. Scanning & Enumeration
3. Exploitation
4. Persistence
5. Covering Your Tracks

In order to have gained this low-level access, you had to work through the first three stages.
- Now you just need to repeat that same three-step process on this compromised machine.
- You need more ***enumeration*** so you know what you have, what you're looking at, what you have to work with.
  - We first look for the "quick wins" (the easy paths).
  - If we don't find one, then we dig deeper.
- And, as you come across new escalation paths, you'll need to enumerate there, also (so you know what you have, what you have to work with, etc.).

### Quick Wins:

Look for "quick wins" as soon as you gain access:
1. Find out who you are on the compromised machine.
2. Find out the architecture of the compromised machine.
3. Find out what sudo privileges you have.
4. Find out what history is available to me.

## System Enumeration

You just gained access to a machine, so you need to take a look at what you're working with: 
- Kernel Version (is it vulnerable to anything?)
- What architecture are we on (64-bit)?
- What services are running (because they also provide a potential attack surface)?

```
$ hostname
```
- Shows you the same hostname, same as follows the username@ in the prompt
- Sometimes this is important, especially in capture-the-flag scenarios.
  - Example: The HTB box named "Blue" might likely be an "EternalBlue" exploit. 
  - Example: A hostname of "Jerry" might be realted to a "Tomcat" exploit. 

```
$ uname -a
```
- This gives you distro and kernel version information (amd64 / x86_64 = 64-bit machine)
- This will give us information we can use to search with for kernel exploits. 
- Copy the Linux kernal version and Google exploits for it.

```
$ cat /proc/version  # similar information as uname
$ cat /etc/issue     # distro info
```

```
$ lscpu  # architecture info (64-bit cpu, threads, core count, vendor type, etc.)
```
- Some exploits require multiple threads and/or multiple cores.
- That dependency/requirement info can be found here

```
$  ps aux              # see what services are running
$  ps aux | grep root  # see what services are running as root
```
- This will show you services like cron, nginx, exim, apache, nfs (network file share), etc. 

## User Enumeration

We want to know: 
1. Who are we?
2. What permissions to do we have?
3. What are we capable of doing (sudo stuff)?

```
$ whoami  # this should give you the same username as in the prompt
$ id      # what our user id (UID) is, what our group id (GID) is; you also get user and group names
```

```
$ sudo -l  # this will list (-l) the allowed (and forbidden) command for the invoking user
```
- Make sure you always try: `sudo su -`
  - Use the compromised password for your compromised user whose account you are currently using
  - You never know--this would be a quick win!
- Something like this is very bad (but very good for us):

![image](https://github.com/user-attachments/assets/4de8362b-4878-430c-aa9e-87a3e19c8eaf)

```
$ cat /etc/group   # what groups are configured on the machine?
$ cat /etc/passwd  # this will give you the other users configured on the system
$ cat /etc/shadow  # password file
```
- If you have access to the shadow (password) file, that's bad (but good for us). 
- Grab the hash. Pass the hash. Crack the hash.

```
$ history  # display the command history for the current user
```
- Has this user done anything juicy in the past? 
- You may find a change in password and be able to read in plaintext the new password for something.

## Network Enumeration
> This is important because it will tell you what connections are out there, what you are interacting with, what ports are open, etc.

You want to simply get the "lay of the land": 
1. What ports are open?
2. With whom are we communicating on the network?
3. Who is out there?
4. What is our network?
5. What networks do we have access to?
6. Are we "dual-homed"? (2 NICs = 2 Networks)

**NOTE:** some of these commands may not work. It depends on the version of Linux your compromised target has installed. 

```
$  ifconfig  # shows network and connection information, NICs, IP addresses
$ ip -c a    # new version of ifconfig
```
- These two commands will show you if the machine is "dual-homed" (i.e., two NICs).
- This may be an opportunity to pivot to another machine on another network.

```
$ route     # this could potentially show you a route to another network
$ ip route  # same as above (route)
$ arp -a    # show the arp table and what machines we are communicating with on the local network
$ ip neigh  # (for neighbor) same as above (arp -a)
```

```
$ netstat -ano  # identify open ports and open lines of communication with other machines on the network
```
- Pay attention to ports open on 127.0.0.1. These are services open only to the localhost.
- It could give you an attack vector. 

## Password Hunting
> The whole trick here is to get good at searching for and searching through files. 

See entire separate file herein for Automated Tools / Automating Local Enumeration.

```
$ grep --color=auto -rnw '/' -ie "PASSWORD" --color=always 2>/dev/null
```
- This looks for the word "PASSWORD" within files starting at the root directory ('/').
- With the color switch, we get the results in red so they are easy to see.
- You may need to focus this in a little better so you don't get so many results.
- First look through the initial results then tweak your command a little bit. For example:

```
$ grep --color=auto -rnw '/' -ie "PASSWORD=" --color=always 2>/dev/null
```

```
$ locate password | more  # Looks for the word "password" in a filename
$ locate passw | more     # Broadens the search for files names with "passw" in them
$ locate pwd | more       # Same concept
```

```
$ find / -name authorized_keys 2>/dev/null   # finds ssh keys
$ find / -name id_rsas 2>/dev/null           # finds ssh keys
```

