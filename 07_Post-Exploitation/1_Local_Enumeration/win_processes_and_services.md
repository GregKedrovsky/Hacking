# Enumerating Processes & Services

## Contents
- [Intro](#intro)
  - [Why Do This?](#why-do-this)
  - [Definitions](#definitions)
- [Techniques & Tools](#techniques--tools)
  - [Meterpreter Session](#meterpreter-session)
  - [Manual: Shell Commands](#manual-shell-commands)

## Intro

### Why Do This?
- After gaining initial access to a target system, it is always important to learn more about the system like...
  - What processes are running?
  - What services are running?
  - What scheduled tasks are running?
- What are we looking for (in general terms)?
  - Running processes
  - Running services
  - Schedule tasks
- Why do we need all this info?
  - Maybe we can migrate our initial access to a process or service with elevated privileges.
  - Maybe we can use a scheduled task to obtain persistence.
 
### Definitions
- A **_process_** is an instance of a running executable (.exe) or program.
- A **_service_** is a process which runs in the background and does not interact with the desktop.

## Techniques & Tools

### Meterpreter Session
```
ps    # list out all the running processes
```
- You get a list in columns (each column is a different descriptive field of the running process)
- Most important:
  - Name: the process name
  - PID: the process ID number
  - User: [most important] Displays "user" who "owns" the process
- **Example:** Suppose we want to migrate our meterpreter session to explorer.exe to elevate our privileges.
  - Whenever you want a stable meterpreter session, it is recommended that you migrate to `explorer.exe`.
  - Use `pgrep` : grep-type search of all running processes
  - e.g., `pgrep explorer.exe` : This is provide you with the process id of explorer.exe
  - meterpreter commando to migrate: `migrate [pid]`

### Manual: Shell Commands
- From meterpreter: `shell`

#### `net start`
- Lists out Windows services that are started
- These are services, not processes.
- These are programs running in the background that do not interact with the desktop
- Example: DHCP Client, Print Spooler, Remote Desktop Services

#### `wmic service list brief`
- List out currently running services in column format
- This information will become very important during privilege escalation

#### `tasklist /SVC`
- This will display the list of running processes as well as the services that are running under a particular process.
- Enumerate the list of running processes and the respective services being used by the processes.
- Example: (**_most important_**) lsass.exe
  - You get the process itself (lsass.exe)
  - And then you get a list of other services (in the "Services" column) that are running under that particular process (e.g., KeyIso, SamSs).
 
#### `schtasks /query /fo LIST`
- List out the scheduled tasks on the system
- This will result in a considerable amount of information
- Recommendation: copy and paste all this info into a text file for use later during post-exploit activities like trying to establish persistence.

#### `schtasks /query /fo LIST /v`
- Verbose; display additional information 
