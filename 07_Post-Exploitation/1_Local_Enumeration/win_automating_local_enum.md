# Automating Windows Local Enumeration

## Contents
- [Intro](#intro)
  - [Why Automate?](#why-automate)
  - [Windows Local Enum Scripts: JAWS](#windows-local-enum-scripts-jaws)
- [Techniques & Tools](#techniques--tools)
  - [Automation with MetaSploit](#automation-with-metasploit)
  - [Automation with JAWS](#automation-with-jaws)

## Intro

### Why Automate?
- In addition to performing local enumeration manually, we can also automate the process with the help of a few scripts and MSF modules.
- While local enumeration techniques and commands are important to know, as a pentester you will need to be time efficient. As a result you will need to learn how to utilize various automated enumeration scripts.
- In addition to automating the process of enumerating information like system information, users, and groups, these automated enumeration scripts will also provide you with additional information regarding the target system like:
  - privilege escalation vulnerabilities
  - locally stored passwords
  - etc.

### Windows Local Enum Scripts: JAWS
- JAWS: [Just Another Windows (Enum) Script](https://github.com/411Hall/JAWS)
- JAWS is a PowerShell script designed to help pentesters (and CTFers) quickly identify potential privilege esclation vectors on Windows systems.
- JAWS is written using Powershell 2.0 so it should run on every Windows version since Windows 7.

## Techniques & Tools

### Automation with MetaSploit
> This is post-exploitation. We are assuming you have compromised a Windows target and have an unprivileged meterprreter session.

#### `show_mount`
- This is a meterpreter command. Run it in your meterpreter session.
- This will list out the mounts and drives on the target system (remember: this is a meterpreter command, not an msfconsole command).
- **Background your meterpreter session.**
  - The following are MetaSploit modules.
  - Several (if not all) of the following use the meterpreter session to run
  - Therefore you still need the meterpreter session. Just background it and take note of the session ID number.
  - Search for the name indicated below.

#### `win_privs`
- This will display the currect user's privileges
- Set options and run
- Pretty much the same as getprivs command in meterpreter; it does provide a little more info, though.

#### `enum_logged_on_users`
- Enumerates the users currently logged onto the target system in addition to the recently logged on users.
- set options and run

#### `checkvm`
-This module will check to see if the target is a virtualmachine
- There are 3 flavors of this module: linux, solaris, windows.  Select the Windows version...
- set options and run

#### `enum_applications`
- Enumerate installed programs and applications on the target system
- You might be able to find a program or application that has a vulnerability you could exploit, specifically a priv esc exploit.
- set options and run

#### `enum_computers`
- This module will enumerate the other systems on your target's network
- use it... set options... run
- This will provide you with information about computers related to the target system

#### `enum_patches`
- Enumerate the patches (updates and hotfixes) that have been applied to the target system and when (the date) they have been installed.
- set options and run

#### `enum_shares`
- Enumerates a list of SMB shares accessible from the target system
- set options and run

### Automation with JAWS

#### Copy from the Repo
- First, you need to copy the PowerShell script [from the GitHub repo](https://github.com/411Hall/JAWS) to your attack machine.
- Note the "Current Features" section of the README.md section for a list of tasks this script automates.

#### Upload JAWS to the Target
- Use your meterpreter session
- Navigate to the root of the target C: drive: `cd C:\\`
  - Always upload your goodies to the Temp folder off the root of the C: drive.
  - If there isn't one, create one: `mkdir Temp`
  - `cd Temp` to go down into that directory
- Upload `jaws-enum.ps1` to upload the script to the `C:\Temp\` directory.

#### Target Command Shell
- Open up a command shell session on the target system (from meterpreter): `shell  `
- `dir` to make sure the script is available (if not, navigate to the subidir).
- To execute a PowerShell script from within a Windows command shell session...
  - Windows, by default, does not allow users to execut PowerShell scripts.
  - So when you execute it, you need to explicity specify the execution policy.
  - Also, because this script will output a lot of information, you need to capture it in a text file
```
powershell.exe -ExecutionPolicy Bypass  -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt  
```
- The script will take a while to run. Be patient. Wait...
  - If you get a message that a few checks failed, don't worry about it.
  - You still get a butt ton of information
 
#### Download the Output
- Download the output text file to your attack machine via meterpreter
- `ctrl-c` to terminate your shell session and get back into meterpreter
- Command: `download JAWS-Enum.txt`
- Now you can open it up in a text editor and analyze the information you obtained
