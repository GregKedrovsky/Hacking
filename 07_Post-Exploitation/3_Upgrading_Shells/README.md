# Upgrading Shells (Linux)

## Contents
- []()

## Upgrading Non-Interactive Shells
- This is a problem that affects Linux targets
- Sometimes when you compromise a Linux target, you get a non-interactive shell (a shell with no prompt or anything indicating you are on the target machine).
- We have used the following command to get an interactive shell:  /bin/bash -i
- This video discusses why this is best practice

## Techniques & Tools
> This is post-exploitation, therefore we are assuming below that we have compromised a Linux machine with MetaSploit. We have been provided with a non-interactive shell on that target. This type of shell is often what you receive when you obtain a reverse shell via a netcat listener.

### The Initial Access: Shell
- A **_non-interactive_** shell does not provide you with a prompt.
  - Therefore, if you have shell access (you ls or pwd and get results) without a prompt, then you have a non-interactive shell.
- An **_interactive_** Bash shell is much more stable than the non-interactive shell: `/bin/bash -i`
  - Problem: What if your target does not have Bash installed...?

### Shells Available on the Target
```
cat /etc/shells
```
- Displays the list of shells installed on the target system
- You can do this from the non-interactive shell

### Bourne Shell (sh)
```
 /bin/sh -i
```
- If you do not have /bin/bash but have /bin/sh, then you can create a Bourne shell with the above command.
- Bash (Bourne Again Shell) is much more robust, so if you have the choice, choose Bask over Bourne.

### Python
```
python --version
python -c 'import pty; pty.spawn("/bin/bash")'
```
- This command will check to see if Python is installed on the target machine.
- If it is installed, run the second command above and this will give you a Bash session.

### Perl
```
perl --help
perl -e 'exec "/bin/bash";'
perl: exec "/bin/bash";       # alternate syntax, your mileage may vary
```
- This command will check to see if Perl is installed on the target machine.
- If it is installed, run the second command above and this will give you a Bash session.

### Ruby
```
ruby: exec "/bin/bash"
```

### Display Environment Variables
- One thing you want to do after upgrading your shell to an interactive shell is display the target's environment variables. 
```
env   # display the values set for the current user's environment variables
```
- If you see the path to execute binaries is not set up, do so.
- You just need to create the PATH variable with the most common subdirs were binaries are found.
```
export PATH=/usr/local/bin:/usr/local/sbin: /usr/bin:/usr/sbin:/bin:/sbin  
```
- A couple more variables to set (on the target):
```
export TERM=xterm    # default terminal
export SHELL=bash    # default shell
```
